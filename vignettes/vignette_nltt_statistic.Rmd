---
title: "Demonstration of nLTTstat function"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Demonstration of nLTTstat function}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

`nLTTstat` calculates the nLTT statistic values, which is
a measure of mismatch between one phylogeny and multiple posterior
phylogenies.

In this vignette:

 * an introduction of the data we work on
 * a detailed demo how to calculate the nLTT statistic
 * a demo of how to use the function itself

## General setup

Load all libraries:

```{r}
library(nLTT)
options(warn = 2)
```

Set the random number generator seed. 

```{r}
set.seed(42)
```

Setting a random number generator seed makes the results reproducible.

The data we work on will be:

 * a species tree
 * a posterior, consisting of multiple phylogenies

First we construct a species tree:

```{r}
species_tree <- ape::rcoal(n = 10)
```

Here the phylogeny and nLTT plot are displayed:

```{r fig.width = 7, fig.height = 4}
par(mfrow = c(1, 2))
ape::plot.phylo(species_tree)
nLTT::nltt_plot(species_tree)
par(mfrow = c(1, 1))
```

Then we collect four possible posterior species trees:

```{r}
posteriors <- list(
  ape::rcoal(n = 10), 
  ape::rcoal(n = 10), 
  species_tree, 
  ape::rcoal(n = 10)
)
```

Here these phylogenies and nLTT plots are displayed:

```{r fig.width = 7, fig.height = 10}
par(mfrow = c(4, 2))
for (i in 1:length(posteriors)) {
  ape::plot.phylo(posteriors[[i]], cex = 1)
  nLTT::nltt_plot(posteriors[[i]])
}
par(mfrow = c(1, 1))
```

Here we display the nLTT plots of both the original
species tree (thicker lines) and its posteriors:

```{r fig.width = 7, fig.height = 7}
# Set the plot area
nLTT::nltt_plot(species_tree)
# Set the background to light grey
rect(par("usr")[1],par("usr")[3],par("usr")[2],par("usr")[4], col = colors()[240])
# Draw the species tree
nLTT::nltt_lines(species_tree, lwd = 5)
# Draw the posteriors
for (i in 1:length(posteriors)) {
  nLTT::nltt_lines(posteriors[[i]], lwd = 3, lty = 2, col = i + 1)
}
```

Then we calculate the nLTT statistic between original species
tree and each posterior tree:

```{r}
nltt_stats <- rep(x = 0, times = length(posteriors))
for (i in 1:length(posteriors)) {
  nltt_stats[i] <- nLTTstat_exact(species_tree, posteriors[[i]])
}
```

One of the posterior tree is a copy of the input phylogeny.
This allows us to check our algorithm: the final nLTT statistic
should be zero for that posterior tree.

Here we put the results in a data frame and display it as a table:

```{r}
nltt_stats <- data.frame(
  id = seq(1, length(nltt_stats)),
  nltt_stat = nltt_stats
)
knitr::kable(nltt_stats)
```

Or as a boxplot:

```{r}
ggplot2::ggplot(
  data = nltt_stats, 
  ggplot2::aes(x = 1, y = nltt_stats$nltt_stat)
) + ggplot2::geom_boxplot(
) + ggplot2::geom_point(color = nltt_stats$id
) + ggplot2::scale_y_continuous(name = "nLTT statistic"
) + ggplot2::scale_x_discrete(name = "The one posterior"
) + ggplot2::ggtitle("Posterior nLTT statistic distribution")
```
