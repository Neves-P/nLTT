---
title: "Trees with a root edge"
author: "Richel Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Trees with a root edge}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This document intends to display a feature of the nLTT package:
if a stem is added to a phylogeny, the begin of that stem
is set as the most recent common ancestor.

Here I create a random phylogeny:

```{r}
set.seed(42)
p <- ape::rcoal(4)
```

Here is how it looks like:

```{r fig.width = 3, fig.height = 3}
ape::plot.phylo(p, root.edge = TRUE)
ape::add.scale.bar()
```

I set `root.edge` to `TRUE`, just show it is absent.

I copy that same phylogeny and add a stem:

```{r}
q <- p
stem_length <- 1
q$root.edge <- stem_length
```

This is how that phylogeny looks like:

```{r fig.width = 3, fig.height = 3}
ape::plot.phylo(q, root.edge = TRUE)
ape::add.scale.bar()
```

When overlaying their nLTT plots, one can expect two things:

 * it is assumed that the phylogeny without a root is leading, and the 
   other phylogeny has its root removed
 * it is assumed that the phylogeny with a root is leading, and the 
   other phylogeny is assumed to have a root of length zero

The nLTT package does the latter:

```{r fig.width = 3, fig.height = 3}
nLTT::nltt_plot(p)
nLTT::nltt_lines(q, col = "red")
```

When looking at the nLTT plot, one can eyeball that 
the nLTT statistic (the surface between the two curves)
is around about 0.4.

But when calculating the nLTT statistic, it ignores the stems, resulting
in an nLTT statistic of zero:

```{r}
testit::assert(nLTT::nLTTstat_exact(p, q, ignore_stem = TRUE) < 0.01)
testit::assert(nLTT::nLTTstat_exact(p, q, ignore_stem = FALSE) > 0.1)
print(nLTT::nLTTstat_exact(p, q, ignore_stem = FALSE))

c(-1 * rev(sort(ape::branching.times(p))), 0)
c(-1 * rev(sort(ape::branching.times(q))), 0) + stem_length
c(-1 * rev(sort(ape::branching.times(q))), 0)


```


